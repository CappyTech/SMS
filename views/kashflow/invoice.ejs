<div class="container my-5">
    <h1 class="mb-4 text-center">Invoices Dashboard</h1>
    <div class="row mb-4">
        <div class="col-md-12">
            <h4>Total Invoices</h4>
            <p><strong>Paid:</strong> <%= paidInvoicesCount %></p>
            <p><strong>Unpaid:</strong> <%= unpaidInvoicesCount %></p>
        </div>
    </div>

    <!-- Search and Filter Form -->
    <div class="row mb-4">
        <div class="col-md-12">
            <form id="searchForm">
                <div class="row">
                    <div class="col-md-4">
                        <input type="text" id="searchInput" class="form-control" placeholder="Search by Invoice Number">
                    </div>
                    <div class="col-md-4">
                        <select id="statusFilter" class="form-control">
                            <option value="">All</option>
                            <option value="paid">Paid</option>
                            <option value="unpaid">Unpaid</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <button type="button" class="btn btn-primary" onclick="filterInvoices()">Search</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Results Table -->
    <h3>Recent Invoices</h3>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Invoice Number</th>
                <th>Net Amount</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="invoiceTableBody">
            <% invoices.forEach(invoice => { %>
            <tr>
                <td><%= invoice.InvoiceNumber %></td>
                <td>£<%= invoice.NetAmount %></td>
                <td>
                    <% if (invoice.Paid) { %>
                    <span class="badge bg-success">Paid</span>
                    <% } else { %>
                    <span class="badge bg-warning">Unpaid</span>
                    <% } %>
                </td>
            </tr>
            <% }) %>
        </tbody>
    </table>
</div>

<script>
    function filterInvoices() {
        const searchInput = document.getElementById('searchInput').value;
        const statusFilter = document.getElementById('statusFilter').value;
        const tableBody = document.getElementById('invoiceTableBody');
        const invoices = <%- JSON.stringify(invoices) %>;

        const filteredInvoices = invoices.filter(invoice => {
            const matchesSearch = invoice.InvoiceNumber.toString().toLowerCase().includes(searchInput);
            const matchesStatus = statusFilter === '' || 
                                  (statusFilter === 'paid' && invoice.Paid) || 
                                  (statusFilter === 'unpaid' && !invoice.Paid);
            return matchesSearch && matchesStatus;
        });

        tableBody.innerHTML = filteredInvoices.map(invoice => `
            <tr>
                <td>${invoice.InvoiceNumber}</td>
                <td>£${invoice.NetAmount}</td>
                <td>
                    ${invoice.AmountPaid >= invoice.NetAmount ? 
                        '<span class="badge bg-success">Paid</span>' : 
                        '<span class="badge bg-warning">Unpaid</span>'}
                </td>
            </tr>
        `).join('');
    }
</script>