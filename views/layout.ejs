<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= typeof title !== 'undefined' ? title : 'Subcontractor Management System' %></title>
  <link href="/node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/node_modules/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="manifest" href="/manifest/manifest.json">
</head>
<body class="bg-body-secondary">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg bg-body-tertiary d-print-none">
    <div class="container">
      <!-- Sidebar Toggle Button -->
      <% if (typeof session.user !== 'undefined') { %>
      <!--
      <button class="btn btn-outline me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSidebar" aria-controls="offcanvasSidebar">
        <i class="bi bi-list"></i>
      </button>
      -->
      <% } %>
      <!-- Navbar Brand -->
      <a class="navbar-brand d-flex align-items-center" href="/">
        <img src="/images/favicon.png" alt="Favicon" class="me-2" width="32" height="32">
        <span class="d-none d-md-inline">Heron Constructive Solutions LTD</span>
      </a>

      <div data-bs-toggle="modal" data-bs-target="#infoModal" style="cursor: pointer;">
        <small>
          <i class="bi bi-info"></i><%= package %>
        </small>
      </div>

      <ul class="navbar-nav ms-auto hstack gap-3">
        <% if (typeof session.user !== 'undefined') { %>
          <%- include('./partials/notify.ejs') %>
        <% } else { %>
          <li class="nav-item">
            <a class="nav-link" href="/signin"><i class="bi bi-box-arrow-in-right"></i> Sign in</a>
          </li>
          <!-- <li class="nav-item">
            <a class="nav-link" href="/register"><i class="bi bi-book"></i> Create an account</a>
          </li> -->
        <% } %>
        <div class="form-check form-switch">
          <label class="form-check-label me-2" for="darkModeToggle">Dark/Light</label>
          <input class="form-check-input" type="checkbox" id="darkModeToggle">
        </div>
      </ul>
    </div>
  </nav>
<% if (typeof session.user !== 'undefined') { %>
  <nav class="navbar navbar-expand-lg bg-body-tertiary d-print-none">
    <div class="container">
      <ul class="navbar-nav">
        <li class="nav-item dropdown mega-menu">
          <button class="btn btn-outline me-2 dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="bi bi-list"></i> Menu
      </button>
          <div class="dropdown-menu mega-menu p-3 bg-body">
            <div class="container">
              <div class="d-flex justify-content-between flex-wrap">
                <div class="col">
                  <div class="display-7">| New</div>
                  <ul class="nav d-flex flex-row">
                    <li class="nav-item me-3">
                      <a class="nav-link" href="/invoice/create">
                        <i class="bi bi-receipt me-2"></i>
                        Invoice
                      </a>
                    </li>
                    <li class="nav-item me-3">
                      <a class="nav-link" href="/subcontractor/create">
                        <i class="bi bi-people me-2"></i>
                        Subcontractor
                      </a>
                    </li>
                    <li class="nav-item me-3">
                      <a class="nav-link" href="/quote/create">
                        <i class="bi bi-file-earmark-text me-2"></i>
                        Quote
                      </a>
                    </li>
                    <li class="nav-item me-3">
                      <a class="nav-link" href="/client/create">
                        <i class="bi bi-people me-2"></i>
                        Client
                      </a>
                    </li>
                    <li class="nav-item me-3">
                      <a class="nav-link" href="/contact/create">
                        <i class="bi bi-telephone me-2"></i>
                        Contact
                      </a>
                    </li>
                    <li class="nav-item me-3">
                      <a class="nav-link" href="/location/create">
                        <i class="bi bi-pin-map-fill me-2"></i>
                        Location
                      </a>
                    </li>
                    <li class="nav-item me-3">
                      <a class="nav-link" href="/attendance/create">
                        <i class="bi bi-person-raised-hand"></i>
                        Attendance
                      </a>
                    </li>
                    <li class="nav-item me-3">
                      <a class="nav-link" href="/employee/create">
                        <i class="bi bi-person-standing"></i>
                        Employee
                      </a>
                    </li>
                    <li class="nav-item me-3">
                      <a class="nav-link" href="/user/create">
                        <i class="bi bi-person me-2"></i>
                        User
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
              <hr>
              <div class="d-flex justify-content-between flex-wrap mt-4">
                <div class="col">
                  <div class="display-7">| Dashboards</div>
                  <ul class="nav flex-column">
                    <li class="nav-item">
                      <a href="/dashboard/stats" class="nav-link hcs-green-text">
                        <i class="bi bi-binoculars me-2"></i>Overview
                      </a>
                    </li>
                    <li class="nav-item"></li>
                      <a href="/attendance/weekly" class="nav-link hcs-green-text">
                        <i class="bi bi-person-raised-hand"></i>Weekly Attendance
                      </a>
                    </li>
                  </ul>
                </div>
                <div class="col">
                  <div class="display-7">| Construction Industry Scheme</div>
                  <ul class="nav flex-column">
                    <li class="nav-item">
                      <a href="/dashboard/invoice" class="nav-link hcs-green-text">
                        <i class="bi bi-receipt me-2"></i>Invoices
                      </a>
                    </li>
                    <li class="nav-item">
                      <a href="/dashboard/subcontractor" class="nav-link hcs-green-text">
                        <i class="bi bi-people me-2"></i>Subcontractors
                      </a>
                    </li>
                    <li class="nav-item">
                      <a href="/monthly/returns/form" class="nav-link hcs-green-text">
                        <i class="bi bi-file-spreadsheet-fill me-2"></i> Monthly Returns
                      </a>
                    </li>
                  </ul>
                </div>
                <div class="col">
                  <div class="display-7">| Contract Management</div>
                  <ul class="nav flex-column">
                    <li class="nav-item">
                      <a href="/dashboard/quote" class="nav-link hcs-green-text">
                        <i class="bi bi-file-earmark-text me-2"></i>Quotes
                      </a>
                    </li>
                    <li class="nav-item">
                      <a href="/dashboard/job" class="nav-link hcs-green-text">
                        <i class="bi bi-briefcase me-2"></i>Jobs
                      </a>
                    </li>
                    <li class="nav-item">
                      <a href="/dashboard/client" class="nav-link hcs-green-text">
                        <i class="bi bi-people me-2"></i>Clients
                      </a>
                    </li>
                    <li class="nav-item">
                      <a href="/dashboard/contact" class="nav-link hcs-green-text">
                        <i class="bi bi-telephone me-2"></i>Contacts
                      </a>
                    </li>
                    <li class="nav-item">
                      <a href="/dashboard/location" class="nav-link hcs-green-text">
                        <i class="bi bi-pin-map-fill me-2"></i>Locations
                      </a>
                    </li>
                  </ul>
                </div>
                <div class="col">
                  <div class="display-7">| Payroll</div>
                  <ul class="nav flex-column">
                    <li class="nav-item">
                      <a href="/dashboard/attendance" class="nav-link hcs-green-text">
                        <i class="bi bi-person-raised-hand"></i>Attendance
                      </a>
                    </li>
                    <li class="nav-item">
                      <a href="/dashboard/employee" class="nav-link hcs-green-text">
                        <i class="bi bi-person-standing"></i>Employees
                      </a>
                    </li>
                  </ul>
                </div>
                <div class="col">
                  <% if (typeof session.user !== 'undefined' && session.user.role === 'admin') { %>
                  <div class="display-7">| Administration</div>
                  <ul class="nav flex-column">
                    <li class="nav-item">
                      <a href="/dashboard/user" class="nav-link hcs-green-text">
                        <i class="bi bi-person me-2"></i>Users
                      </a>
                    </li>
                  </ul>
                  <% } %>
                  <div class="display-7">| My Account</div>
                  <ul class="nav flex-column">
                    <li class="nav-item">
                      <a class="nav-link hcs-green-text" href="/account">
                        <i class="bi bi-gear-wide me-2"></i>
                        Settings
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link hcs-red-text" href="/logout">
                        <i class="bi bi-box-arrow-right me-2"></i>
                        Logout
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </li>
      </ul>
    </div>
  </nav> 
<% } %>
  <!-- Offcanvas Sidebar -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasSidebar" aria-labelledby="offcanvasSidebarLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title text-white" id="offcanvasSidebarLabel"></h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <div class="display-7">| New</div>
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link" href="/subcontractor/select">
            <i class="bi bi-receipt"></i>
            Invoice
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/subcontractor/create">
            <i class="bi bi-people"></i>
            Subcontractor
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/quote/create">
            <i class="bi bi-file-earmark-text"></i>
            Quote
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/client/create">
            <i class="bi bi-people"></i>
            Client
          </a>
        </li>
        <li class="nav-item">
          <a href="/client/select" class="nav-link">
            <i class="bi bi-telephone me-2"></i>Contact
          </a>
        </li>
        <li class="nav-item">
          <a href="/location/create" class="nav-link">
            <i class="bi bi-telephone me-2"></i>Location
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/user/create">
            <i class="bi bi-person"></i>
            User
          </a>
        </li>
      </ul>
      <div class="display-7">| Dashboards</div>
      <ul class="nav flex-column">
        <li class="nav-item">
          <a href="/dashboard/stats" class="nav-link hcs-green-text">
            <i class="bi bi-binoculars me-2"></i>Overview
          </a>
        </li>
      </ul>
      <div class="display-7">| Construction Industry Scheme</div>
      <ul class="nav flex-column">
        <li class="nav-item">
          <a href="/dashboard/invoice" class="nav-link hcs-green-text">
            <i class="bi bi-receipt me-2"></i>Invoices
          </a>
        </li>
        <li class="nav-item">
          <a href="/dashboard/subcontractor" class="nav-link hcs-green-text">
            <i class="bi bi-people me-2"></i>Subcontractors
          </a>
        </li>
        <li class="nav-item">
            <a href="/monthly/returns/form" class="nav-link hcs-green-text">
              <i class="bi bi-file-spreadsheet-fill"></i> Monthly Returns
            </a>
          </li>
      </ul>
      <div class="display-7">| Contract Management</div>
      <ul class="nav flex-column">
        <li class="nav-item">
          <a href="/dashboard/quote" class="nav-link hcs-green-text">
            <i class="bi bi-file-earmark-text me-2"></i>Quotes
          </a>
        </li>
        <li class="nav-item">
          <a href="/dashboard/job" class="nav-link hcs-green-text">
            <i class="bi bi-briefcase me-2"></i>Jobs
          </a>
        </li>
        <li class="nav-item">
          <a href="/dashboard/client" class="nav-link hcs-green-text">
            <i class="bi bi-people me-2"></i>Clients
          </a>
        </li>
        <li class="nav-item">
          <a href="/dashboard/contact" class="nav-link hcs-green-text">
            <i class="bi bi-telephone me-2"></i>Contacts
          </a>
        </li>
        <li class="nav-item">
          <a href="/dashboard/location" class="nav-link hcs-green-text">
            <i class="bi bi-telephone me-2"></i>Locations
          </a>
        </li>
      </ul>
      <div class="display-7">| Payroll</div>
      <ul class="nav flex-column">
        <li class="nav-item">
          <a href="/dashboard/user" class="nav-link hcs-green-text">
            <i class="bi bi-person-raised-hand"></i>Attendance
          </a>
        </li>
        <li class="nav-item">
          <a href="/dashboard/user" class="nav-link hcs-green-text">
            <i class="bi bi-person-standing"></i>Employees
          </a>
        </li>
      </ul>
      <div class="display-7">| Administration</div>
      <ul class="nav flex-column">
        <li class="nav-item">
          <a href="/dashboard/user" class="nav-link hcs-green-text">
            <i class="bi bi-person me-2"></i>Users
          </a>
        </li>
      </ul>
      <div class="display-7">| My Account</div>
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link hcs-green-text" href="/account">
            <i class="bi bi-gear-wide"></i>
            Settings
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link hcs-red-text" href="/logout">
            <i class="bi bi-box-arrow-right"></i>
            Logout
          </a>
        </li>
      </ul>
    </div>
  </div>

  <!-- Main Content -->
  <div class="content bg-body">
    <%- body %>
  </div>

  <!-- Footer -->
  <footer class="footer mt-auto d-print-none bg-body">
    <nav class="navbar navbar-expand d-flex justify-content-center align-items-center mt-5 p-4 text-center">
      <div class="stack-on-small">
        <div>
          <a href="/"><img src="/images/favicon.png" alt="HCS Logo"></a>
          <a class="hcs-green-text" href="https://www.heroncs.co.uk">Heron Constructive Solutions Ltd.</a><br>
          Copyright &copy; <%= copyrightyearstart %> - <%= copyrightyear %> | All Rights Reserved.
          <div>
            VAT No: <a class="hcs-green-text" href="https://beta.companieshouse.gov.uk/company/09276951">252295994</a>
            |
            Company No: <a class="hcs-green-text" href="https://beta.companieshouse.gov.uk/company/09276951">09276951</a>
          </div>
        </div>
      </div>
    </nav>
  </footer>

  <!-- Modal Structure -->
  <div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="infoModalLabel">System Information</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p id="pageLoadTime"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="/node_modules/@popperjs/core/dist/umd/popper.min.js"></script>
  <script src="/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
  <script>
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
  </script>
  <script>
    (() => {
      'use strict';
      const getStoredTheme = () => localStorage.getItem('theme');
      const setStoredTheme = theme => localStorage.setItem('theme', theme);
      const getPreferredTheme = () => {
        const storedTheme = getStoredTheme();
        if (storedTheme) {
          return storedTheme;
        }
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      };
      const setTheme = theme => {
        if (theme === 'auto') {
          document.documentElement.setAttribute('data-bs-theme', window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        } else {
          document.documentElement.setAttribute('data-bs-theme', theme);
        }
      };
      setTheme(getPreferredTheme());
      const showActiveTheme = (theme, focus = false) => {
        const themeSwitcher = document.querySelector('#darkModeToggleLabel');
        if (!themeSwitcher) {
          return;
        }
        if (focus) {
          themeSwitcher.focus();
        }
      };
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
        const storedTheme = getStoredTheme();
        if (storedTheme !== 'light' && storedTheme !== 'dark') {
          setTheme(getPreferredTheme());
        }
      });
      window.addEventListener('DOMContentLoaded', () => {
        showActiveTheme(getPreferredTheme());
        document.getElementById('darkModeToggle').addEventListener('change', () => {
          toggleDarkMode();
        });
      });
      const toggleDarkMode = () => {
        const currentTheme = getStoredTheme();
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        setStoredTheme(newTheme);
        setTheme(newTheme);
        showActiveTheme(newTheme, true);
      };
    })();
    const triggerTabList = document.querySelectorAll('[data-bs-toggle="tab"]');
    triggerTabList.forEach(triggerEl => {
      const tabTrigger = new bootstrap.Tab(triggerEl);
      triggerEl.addEventListener('click', event => {
        event.preventDefault();
        tabTrigger.show();
      });
    });
  </script>
  <script>
    const myModal = new bootstrap.Modal(document.getElementById('infoModal'));
    window.addEventListener('load', () => {
      const pageLoadTime = performance.now();
      console.log(`Page load time is ${pageLoadTime.toFixed(2)} ms`);
      const pageLoadTimeElement = document.getElementById('pageLoadTime');
      pageLoadTimeElement.innerHTML = `<strong>Page Load Time:</strong> ${Math.round(pageLoadTime)} ms`;
    });
  </script>
  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('js/service-worker.js')
        .then(registration => {
          console.log('ServiceWorker registration successful with scope: ', registration.scope);
        }, err => {
          console.log('ServiceWorker registration failed: ', err);
        });
    });
  }
  </script>
</body>
</html>
