<div class="container py-4">
    <div class="p-5 mb-4 bg-body-tertiary rounded-3">
        <h1 class="display-5">Update Attendance</h1> <!-- Updated title -->
        <div class="container-fluid text-center">
            <!-- The form action should point to the update route with the attendance ID -->
            <form action="/attendance/update/<%= attendance.id %>" method="POST" class="needs-validation">

                <!-- Auto-populate Date field -->
                <div class="row mb-3">
                    <label for="date" class="col-sm-3 col-form-label">Date</label>
                    <div class="col-sm-9">
                        <input 
                            type="date" 
                            id="date" 
                            name="date" 
                            class="form-control" 
                            value="<%= attendance.date %>" 
                            required
                        >
                    </div>
                </div>

                <!-- Type Selection -->
                <div class="row mb-3">
                    <label for="type" class="col-sm-3 col-form-label">Type</label>
                    <div class="col-sm-9">
                        <select id="type" name="type" class="form-select">
                            <option value="off" <%= attendance.type === 'off' ? 'selected' : '' %>>Off</option>
                            <option value="work" <%= attendance.type === 'work' ? 'selected' : '' %>>Work</option>
                            <option value="holiday" <%= attendance.type === 'holiday' ? 'selected' : '' %>>Holiday</option>
                            <option value="sick" <%= attendance.type === 'sick' ? 'selected' : '' %>>Sick</option>
                            <option value="training" <%= attendance.type === 'training' ? 'selected' : '' %>>Training</option>
                            <option value="leave" <%= attendance.type === 'leave' ? 'selected' : '' %>>Leave</option>
                        </select>
                    </div>
                </div>

                <hr>

                <!-- Employee Selection -->
                <div class="row mb-3">
                    <label for="employeeId" class="col-sm-3 col-form-label">Employee</label>
                    <div class="col-sm-9">
                        <div class="input-group">
                            <select id="employeeId" name="employeeId" class="form-select">
                                <option value="">Select Employee</option>
                                <% employees.forEach(employee => { %>
                                    <option value="<%= employee.id %>" <%= attendance.employeeId === employee.id ? 'selected' : '' %> >
                                        <%= employee.name %>
                                    </option>
                                <% }); %>
                            </select>
                            <a href="/employee/create">
                                <button type="button" class="btn btn-hcs-green">+</button>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Divider: OR -->
                <div class="row mb-3">
                    <label for="div2" class="col-sm-3 col-form-label"><small>OR</small></label>
                    <input type="hidden" id="div2" name="div1">
                </div>

                <!-- Subcontractor Selection -->
                <div class="row mb-3">
                    <label for="subcontractorId" class="col-sm-3 col-form-label">Subcontractor</label>
                    <div class="col-sm-9">
                        <div class="input-group">
                            <select id="subcontractorId" name="subcontractorId" class="form-select">
                                <option value="">Select Subcontractor</option>
                                <% subcontractors.forEach(subcontractor => { %>
                                    <option value="<%= subcontractor.uuid %>" <%= attendance.subcontractorId === subcontractor.uuid ? 'selected' : '' %> >
                                        <%= subcontractor.Name %>
                                    </option>
                                <% }); %>
                            </select>
                        </div>
                    </div>
                </div>

                <hr>

                <!-- Location Selection -->
                <div class="row mb-3">
                    <label for="locationId" class="col-sm-3 col-form-label">Location</label>
                    <div class="col-sm-9">
                        <div class="input-group">
                            <select id="locationId" name="locationId" class="form-select">
                                <option value="">Select Location</option>
                                <% locations.forEach(location => { %>
                                    <option value="<%= location.id %>" <%= attendance.locationId === location.id ? 'selected' : '' %> >
                                        <% if (location.name) { %>
                                            <%= location.name %>
                                        <% } else { %>
                                            <%= location.address %>, <%= location.city %>, <%= location.postalCode %>
                                        <% } %>
                                    </option>
                                <% }); %>
                            </select>
                            <a href="/location/create">
                                <button type="button" class="btn btn-hcs-green">+</button>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Divider: OR -->
                <div class="row mb-3">
                    <label for="div1" class="col-sm-3 col-form-label"><small>OR</small></label>
                    <input type="hidden" id="div1" name="div1">
                </div>

                <!-- Project Selection -->
                <div class="row mb-3">
                    <label for="projectId" class="col-sm-3 col-form-label">Job</label>
                    <div class="col-sm-9">
                        <div class="input-group">
                            <select id="projectId" name="projectId" class="form-select">
                                <option value="">Select Job</option>
                                <% projects.forEach(project => { %>
                                    <option value="<%= project.uuid %>" <%= attendance.projectId === project.uuid ? 'selected' : '' %> >
                                        <%= project.Number %> | <%= project.Name %>
                                    </option>
                                <% }); %>
                            </select>
                        </div>
                    </div>
                </div>

                <hr>

                <!-- Hours Worked -->
                <div class="row mb-3">
                    <label for="hoursWorked" class="col-sm-3 col-form-label">Hours Worked</label>
                    <div class="col-sm-9">
                        <input type="number" id="hoursWorked" name="hoursWorked" class="form-control" min="0" step="0.1" value="<%= attendance.hoursWorked %>">
                    </div>
                </div>

                <!-- Divider: OR -->
                <div class="row mb-3">
                    <label for="div1" class="col-sm-3 col-form-label"><small>OR</small></label>
                    <input type="hidden" id="div1" name="div1">
                </div>

                <!-- Day Rate (For Subcontractors) -->
                <div class="row mb-3">
                    <label for="dayRate" class="col-sm-3 col-form-label">Day Rate (Â£)</label>
                    <div class="col-sm-9">
                        <input type="number" id="dayRate" name="dayRate" class="form-control" min="0" step="0.01" value="<%= attendance.dayRate %>">
                    </div>
                </div>

                <hr>

                <!-- Submit and Delete Options -->
                <span class="d-flex justify-content-between mt-3">
                    <button type="submit" class="btn btn-hcs-green">Update Attendance</button>
                    <a type="button" class="text-hcs-red" data-bs-toggle="modal" data-bs-target="#deleteConfirmationModal">
                        Delete Attendance
                    </a>
                </span>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Delete Confirmation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                Are you sure you want to delete this Attendance?
                <hr>
                <span class="hcs-red-text lead">This action cannot be undone!</span>
            </div>
            <div class="modal-footer d-flex justify-content-between">
                <form action="/attendance/delete/<%= attendance.id %>" method="POST">
                    <button type="submit" class="btn btn-hcs-red">Delete</button>
                </form>
                <a type="button" class="text-hcs-black" data-bs-dismiss="modal">Close</a>
            </div>
        </div>
    </div>
</div>