<div class="container mt-4">
    <div class="text-center">
        <h1 class="mb-4">Monthly Returns Report</h1>
    </div>

    <div class="subcontractor-info mt-4">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title">Subcontractor Information</h5>
            </div>
            <div class="card-body">
                <p><strong>Name:</strong> <%= subcontractor.name %></p>
                <p><strong>Company:</strong> <%= subcontractor.company %></p>
                <p><strong>Address:</strong> <%= subcontractor.line1 %>, <%= subcontractor.line2 %>,
                    <%= subcontractor.city %>, <%= subcontractor.county %>, <%= subcontractor.postalCode %></p>
                <p><strong>CIS Number:</strong> <%= subcontractor.cisNumber %></p>
                <p><strong>UTR Number:</strong> <%= subcontractor.utrNumber %></p>
                <p><strong>Deduction:</strong> <%= subcontractor.deduction %></p>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h5 class="card-title"><%= month %> / <%= year %></h5>
            </div>
            <div class="card-body">
                <% if (invoices.length > 0) { %>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Invoice Number</th>
                            <th>Invoice Date</th>
                            <th>Remittance Date</th>
                            <th>Gross Amount</th>
                            <th>Labour Cost</th>
                            <th>Material Cost</th>
                            <th>CIS Amount</th>
                            <th>Net Amount</th>
                            <th>Submission Date</th>
                            <th>Reverse Charge</th>
                            <th>Month</th>
                            <th>Year</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% let totalGross = 0; %>
                        <% let totalLabourCost = 0; %>
                        <% let totalMaterialCost = 0; %>
                        <% let totalCISAmount = 0; %>
                        <% let totalNetAmount = 0; %>
                        <% let totalReverseCharge = 0; %>
                        <% invoices.forEach(invoice => { %>
                        <tr>
                            <td><%= invoice.invoiceNumber %></td>
                            <td><%= slimDateTime(invoice.invoiceDate) %></td>
                            <td><%= slimDateTime(invoice.remittanceDate) %></td>
                            <td><%= formatCurrency(invoice.grossAmount) %></td>
                            <td><%= formatCurrency(invoice.labourCost) %></td>
                            <td><%= formatCurrency(invoice.materialCost) %></td>
                            <td><%= formatCurrency(invoice.cisAmount) %></td>
                            <td><%= formatCurrency(invoice.netAmount) %></td>
                            <td><%= slimDateTime(invoice.submissionDate) %></td>
                            <td><%= formatCurrency(invoice.reverseCharge) %></td>
                            <td><%= invoice.month %></td>
                            <td><%= invoice.year %></td>
                        </tr>
                        <% totalGross += invoice.grossAmount; %>
                        <% totalLabourCost += invoice.labourCost; %>
                        <% totalMaterialCost += invoice.materialCost; %>
                        <% totalCISAmount += invoice.cisAmount; %>
                        <% totalNetAmount += invoice.netAmount; %>
                        <% totalReverseCharge += invoice.reverseCharge; %>
                        <% }); %>
                        <tr>
                            <td colspan="3"><strong>Total:</strong></td>
                            <td><%= formatCurrency(totalGross) %></td>
                            <td><%= formatCurrency(totalLabourCost) %></td>
                            <td><%= formatCurrency(totalMaterialCost) %></td>
                            <td><%= formatCurrency(totalCISAmount) %></td>
                            <td><%= formatCurrency(totalNetAmount) %></td>
                            <td></td>
                            <td><%= formatCurrency(totalReverseCharge) %></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
                <% } else { %>
                <p class="text-muted text-center">No invoices available for the selected month and year.</p>
                <% } %>
            </div>
        </div>
    </div>
</div>