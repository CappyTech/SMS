<!-- views/dashboard.ejs: -->
<h1>Dashboard</h1>

<% if (typeof message !== 'undefined' && message.length > 0) { %>
<br>
<div class="alert alert-infor alert-dismissible fade show p-3" role="alert">
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    <%= message %>
</div>
<% } %>

<% if (typeof successMessage !== 'undefined' && successMessage.length > 0) { %>
<br>
<div class="alert alert-success alert-dismissible fade show p-3" role="alert">
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    <%= successMessage %>
</div>
<% } %>

<% if (typeof session.user === 'undefined') { %>
<li class="list-group-item d-flex justify-content-between align-items-center">
    <p>You are not logged in.</p>
</li>
<a href="/login" class="btn btn-primary mt-3">Login</a>
<a href="/register" class="btn btn-secondary mt-3">Register</a>
<% } else { %>
<ul class="list-group">
    <% Invoice.forEach(Invoice => { %>
    <li class="list-group-item d-flex justify-content-between align-items-center">
        <a href="/view/<%= Invoice.id %>" data-bs-toggle="tooltip" data-bs-placement="right"
            data-bs-title="View Item: <%= Invoice.id %>"><%= Invoice.invoiceNumber %></a>
        <div class="d-grid gap-2 d-md-block">
            <div data-bs-toggle="tooltip" data-bs-placement="left" data-bs-title="Edit Item: <%= Invoice.id %>">
                <div>
                    <a href="/edit/<%= Invoice.id %>" class="btn btn-info btn-sm me-2"><i
                            class="bi bi-pencil-fill"></i></a>
                </div>
            </div>
            <div data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="Delete Item: <%= Invoice.id %>">
                <a href="#" class="btn btn-danger btn-sm me-2" data-bs-toggle="modal"
                    data-bs-target="#deleteModal<%= Invoice.id %>" data-record-id="<%= Invoice.id %>"><i
                        class="bi bi-trash-fill"></i></a>
            </div>
        </div>
    </li>
    <div class="modal fade" id="deleteModal<%= Invoice.id %>" tabindex="-1"
        aria-labelledby="deleteModalLabel<%= Invoice.id %>" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel<%= Invoice.id %>"><i class="bi bi-heartbreak-fill"></i>
                        Are you
                        sure?
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this record?</p>
                    <div class="mb-3">
                        <label for="title" class="form-label">Invoice Number:</label>
                        <input type="text" class="form-control" id="id" name="id" value="<%= Invoice.invoiceNumber %>"
                            disabled>
                    </div>
                    <div class="mb-3">
                        <label for="title" class="form-label">Kashflow Number:</label>
                        <input type="text" class="form-control" id="id" name="id" value="<%= Invoice.kashflowNumber %>"
                            disabled>
                    </div>
                    <div class="mb-3">
                        <label for="title" class="form-label">Invoice Date:</label>
                        <input type="text" class="form-control" id="id" name="id"
                            value="<%= slimDateTime(Invoice.invoiceDate) %>" disabled>
                    </div>
                    <div class="mb-3">
                        <label for="title" class="form-label">Remittance Date:</label>
                        <input type="text" class="form-control" id="id" name="id"
                            value="<%= slimDateTime(Invoice.remittanceDate) %>" disabled>
                    </div>
                    <div class="mb-3">
                        <label for="title" class="form-label">Gross Amount:</label>
                        <input type="text" class="form-control" id="id" name="id" value="<%= Invoice.grossAmount %>"
                            disabled>
                    </div>
                    <div class="mb-3">
                        <label for="title" class="form-label">Labour Cost:</label>
                        <input type="text" class="form-control" id="id" name="id" value="<%= Invoice.labourCost %>"
                            disabled>
                    </div>
                    <div class="mb-3">
                        <label for="title" class="form-label">Material Cost:</label>
                        <input type="text" class="form-control" id="id" name="id" value="<%= Invoice.materialCost %>"
                            disabled>
                    </div>
                    <div class="mb-3">
                        <label for="title" class="form-label">CIS Amount:</label>
                        <input type="text" class="form-control" id="id" name="id" value="<%= Invoice.cisAmount %>"
                            disabled>
                    </div>
                    <div class="mb-3">
                        <label for="title" class="form-label">NET Amount:</label>
                        <input type="text" class="form-control" id="id" name="id" value="<%= Invoice.netAmount %>"
                            disabled>
                    </div>
                    <div class="mb-3">
                        <label for="title" class="form-label">Submission Date:</label>
                        <input type="text" class="form-control" id="id" name="id"
                            value="<%= slimDateTime(Invoice.submissionDate) %>" disabled>
                    </div>
                    <div class="mb-3">
                        <label for="title" class="form-label">Reverse Charge Amount:</label>
                        <input type="text" class="form-control" id="id" name="id"
                            value="<%= Invoice.reverseChargeAmount %>" disabled>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i
                            class="bi bi-emoji-heart-eyes-fill"></i> Cancel</button>
                    <form id="deleteForm<%= Invoice.id %>" action="/delete/<%= Invoice.id %>" method="POST">
                        <button type="submit" class="btn btn-danger"><i class="bi bi-trash-fill"></i> Delete</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <% }) %>
</ul>

<a href="/create" class="btn btn-primary mt-3">Create New Record</a>

<% } %>

<% if (typeof errorMessages !== 'undefined' && errorMessages.length > 0) { %>
<br>
<div class="alert alert-danger alert-dismissible fade show p-3" role="alert">
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    <% errorMessages.forEach(errorMessage => { %>
    <div><%= errorMessage %></div>
    <% }) %>
</div>
<% } %>