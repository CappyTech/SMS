

<% function isValidDate(date) { return date instanceof Date && !isNaN(date); } %>
<div class="container py-4">
    <div class="p-5 mb-4 bg-body-tertiary rounded-3">
        <h1 class="display-5">Update Invoice</h1>
        <div class="container-fluid">
            <form action="/invoice/update/<%= invoice.id %>" method="POST">
                
                <div class="row mb-3">
                    <label for="invoiceNumber" class="col-sm-3 col-form-label">Invoice Number</label>
                    <div class="col-sm-9">
                        <input type="text" name="invoiceNumber" id="invoiceNumber" class="form-control" value="<%= invoice.invoiceNumber %>" required>
                        <div class="form-text"><small><%= invoice.invoiceNumber %></small></div>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <label for="kashflowNumber" class="col-sm-3 col-form-label">Kashflow Number</label>
                    <div class="col-sm-9">
                        <input type="text" name="kashflowNumber" id="kashflowNumber" class="form-control" value="<%= invoice.kashflowNumber %>" required>
                        <div class="form-text"><small><%= invoice.kashflowNumber %></small></div>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <label for="invoiceDate" class="col-sm-3 col-form-label">Invoice Date</label>
                    <div class="col-sm-9">
                        <input type="date" name="invoiceDate" id="invoiceDate" class="form-control <%= isValidDate(invoice.invoiceDate) ? '' : 'is-invalid' %>" 
                               value="<%= isValidDate(invoice.invoiceDate) ? invoice.invoiceDate.toISOString().split('T')[0] : '' %>" required>
                        <% if (!isValidDate(invoice.invoiceDate)) { %>
                            <div class="invalid-feedback">Please provide a valid invoice date.</div>
                        <% } %>
                        <div class="form-text"><small><%= isValidDate(invoice.invoiceDate) ? invoice.invoiceDate.toISOString().split('T')[0] : '' %></small></div>
                    </div>
                </div>

                <div class="row mb-3">
                    <label for="remittanceDate" class="col-sm-3 col-form-label">Paid Date</label>
                    <div class="col-sm-9">
                        <input type="date" name="remittanceDate" id="remittanceDate" class="form-control <%= isValidDate(invoice.remittanceDate) ? '' : 'is-invalid' %>" 
                               value="<%= isValidDate(invoice.remittanceDate) ? invoice.remittanceDate.toISOString().split('T')[0] : '' %>" required>
                        <% if (!isValidDate(invoice.remittanceDate)) { %>
                            <div class="invalid-feedback">Please provide a valid remittance date.</div>
                        <% } %>
                        <div class="form-text"><small><%= isValidDate(invoice.remittanceDate) ? invoice.remittanceDate.toISOString().split('T')[0] : '' %></small></div>
                    </div>
                </div>

                <div class="row mb-3">
                    <label for="grossAmount" class="col-sm-3 col-form-label">Gross Amount</label>
                    <div class="col-sm-9">
                        <input type="number" step="0.01" name="grossAmount" id="grossAmount" class="form-control" value="<%= invoice.grossAmount %>" disabled>
                        <div class="form-text"><small><%= invoice.grossAmount %></small></div>
                    </div>
                </div>

                <div class="row mb-3">
                    <label for="labourCost" class="col-sm-3 col-form-label">Labour Cost</label>
                    <div class="col-sm-9">
                        <input type="number" step="0.01" name="labourCost" id="labourCost" class="form-control" value="<%= invoice.labourCost %>" required>
                        <div class="form-text"><small><%= invoice.labourCost %></small></div>
                    </div>
                </div>

                <div class="row mb-3">
                    <label for="materialCost" class="col-sm-3 col-form-label">Material Cost</label>
                    <div class="col-sm-9">
                        <input type="number" step="0.01" name="materialCost" id="materialCost" class="form-control" value="<%= invoice.materialCost %>" required>
                        <div class="form-text"><small><%= invoice.materialCost %></small></div>
                    </div>
                </div>

                <div class="row mb-3">
                    <label for="cisAmount" class="col-sm-3 col-form-label">CIS Amount</label>
                    <div class="col-sm-9">
                        <input type="number" step="0.01" name="cisAmount" id="cisAmount" class="form-control" value="<%= invoice.cisAmount %>" disabled>
                        <div class="form-text"><small><%= invoice.cisAmount %></small></div>
                    </div>
                </div>

                <div class="row mb-3">
                    <label for="netAmount" class="col-sm-3 col-form-label">Net Amount</label>
                    <div class="col-sm-9">
                        <input type="number" step="0.01" name="netAmount" id="netAmount" class="form-control" value="<%= invoice.netAmount %>" disabled>
                        <div class="form-text"><small><%= invoice.netAmount %></small></div>
                    </div>
                </div>

                <div class="row mb-3">
                    <label for="submissionDate" class="col-sm-3 col-form-label">Submission Date</label>
                    <div class="col-sm-9">
                        <input type="date" name="submissionDate" id="submissionDate" class="form-control <%= isValidDate(invoice.submissionDate) ? '' : 'is-invalid' %>" 
                               value="<%= isValidDate(invoice.submissionDate) ? invoice.submissionDate.toISOString().split('T')[0] : '' %>">
                        <% if (!isValidDate(invoice.submissionDate)) { %>
                            <div class="invalid-feedback">Please provide a valid submission date.</div>
                        <% } %>
                        <div class="form-text"><small><%= isValidDate(invoice.submissionDate) ? invoice.submissionDate.toISOString().split('T')[0] : '' %></small></div>
                    </div>
                </div>

                <div class="row mb-3">
                    <label for="reverseCharge" class="col-sm-3 col-form-label">Reverse Charge</label>
                    <div class="col-sm-9">
                        <input type="number" step="0.01" name="reverseCharge" id="reverseCharge" class="form-control" value="<%= invoice.reverseCharge %>" disabled>
                        <div class="form-text"><small><%= invoice.reverseCharge %></small></div>
                    </div>
                </div>

                <div class="row mb-3">
                    <label for="month" class="col-sm-3 col-form-label">Tax Month</label>
                    <div class="col-sm-9">
                        <input type="text" name="month" id="month" class="form-control" value="<%= invoice.month %>" required>
                        <div class="form-text"><small><%= invoice.month %></small></div>
                    </div>
                </div>

                <div class="row mb-3">
                    <label for="year" class="col-sm-3 col-form-label">Tax Year</label>
                    <div class="col-sm-9">
                        <input type="text" name="year" id="year" class="form-control" value="<%= invoice.year %>" required>
                        <div class="form-text"><small><%= invoice.year %></small></div>
                    </div>
                </div>

                <div class="d-grid gap-2 mt-4">
                    <button type="submit" class="btn btn-hcs-green"><i class="bi bi-file-earmark-check"></i> Update Invoice</button>
                </div>
            </form>
        </div>
    </div>
</div>
